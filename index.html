<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jomy Kings Multi-Study Platform</title>
    <!-- Load Lucide Icons for Navigation -->
    <script type="module" src="https://unpkg.com/lucide@latest"></script>
    <!-- Load Prism for Code Syntax Highlighting -->
    <link href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism-tomorrow.css" rel="stylesheet"/>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/prism.min.js"></script>

    <style>
        /* ================================================= */
        /* === CUSTOM GLASSMORPHISM CSS (Enhanced & Consolidated) === */
        /* ================================================= */
        /* GLOBAL SETTINGS */
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap');
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Poppins", sans-serif;
        }

        body {
            background: #0b0e13;
            color: #e6e6e6;
            padding-bottom: 90px; /* Space for fixed bottom nav */
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        /* HEADER */
        header {
            text-align: center;
            padding: 25px 10px;
            background: linear-gradient(135deg, #0d1520, #09111a);
            border-bottom: 1px solid rgba(255,255,255,0.05);
            box-shadow: 0 3px 10px rgba(0,0,0,0.25);
            z-index: 10;
        }

        header h1 {
            font-size: 20px; /* Adjusted for mobile space */
            font-weight: 600;
            letter-spacing: 1px;
            color: #4da9ff; /* Blue Accent */
            text-shadow: 0 0 10px rgba(77,169,255,0.4);
        }

        /* NAVIGATION BAR (Fixed Bottom) */
        .nav-bar {
            display: flex;
            justify-content: space-around;
            align-items: center;
            background: rgba(18, 24, 32, 0.95);
            backdrop-filter: blur(8px);
            padding: 12px 0;
            position: fixed;
            bottom: 0;
            width: 100%;
            border-top: 1px solid rgba(255,255,255,0.05);
            box-shadow: 0 -3px 12px rgba(0,0,0,0.35);
            z-index: 1000;
        }

        .nav-bar button {
            all: unset; /* Remove button default styling */
            display: flex;
            flex-direction: column;
            align-items: center;
            color: #7a8694;
            text-decoration: none;
            font-size: 11px;
            font-weight: 500;
            transition: 0.3s;
            cursor: pointer;
            padding: 5px;
        }
        
        .nav-bar button i {
            margin-bottom: 4px;
            width: 20px;
            height: 20px;
            transition: color 0.3s;
        }

        .nav-bar .active {
            color: #4da9ff; /* Blue Accent */
            font-weight: 600;
            text-shadow: 0 0 8px rgba(77,169,255,0.6);
        }

        /* CONTAINER (Main Content Area) */
        main {
            flex-grow: 1;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .content-view {
            padding: 20px;
            margin-top: 10px;
            display: flex;
            flex-direction: column;
            height: 100%; /* Important for chat layout */
            overflow-y: auto; /* Allows scrolling within the view */
            position: absolute; /* Allows views to stack and hide/show cleanly */
            top: 65px; /* Below the header */
            bottom: 80px; /* Above the nav-bar */
            left: 0;
            right: 0;
            background: #0b0e13;
            transition: opacity 0.4s ease-in-out;
        }

        .hidden {
            display: none;
            opacity: 0;
        }

        /* GLASSMORPHISM CARDS */
        .card {
            background: rgba(255, 255, 255, 0.06);
            backdrop-filter: blur(8px);
            border-radius: 18px;
            padding: 18px;
            margin-bottom: 18px;
            border: 1px solid rgba(255,255,255,0.08);
            box-shadow: 0 8px 18px rgba(0,0,0,0.25);
            transition: 0.3s;
        }

        .card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 25px rgba(0, 0, 0, 0.4);
        }

        .card h3, .card h2 {
            font-size: 18px;
            margin-bottom: 8px;
            color: #4da9ff;
            font-weight: 600;
        }

        .card p {
            font-size: 14px;
            color: #bfc9d4;
            margin-bottom: 12px;
        }

        /* BUTTONS */
        .card button, .open-ai-button, .tab-button {
            background: linear-gradient(135deg, #4da9ff, #1c6db3);
            border: none;
            padding: 12px 18px;
            font-size: 14px;
            border-radius: 12px;
            color: #fff;
            margin-top: 10px;
            cursor: pointer;
            width: 100%;
            font-weight: 600;
            letter-spacing: 0.3px;
            box-shadow: 0 5px 15px rgba(77,169,255,0.35);
            transition: 0.25s;
        }

        .card button:hover, .open-ai-button:hover, .tab-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(77,169,255,0.45);
        }

        .tab-button.active {
            background: linear-gradient(135deg, #1c6db3, #4da9ff);
        }
        
        /* CHAT-SPECIFIC STYLES (AI Tutor View) */
        #tutor-view {
            overflow: hidden; /* Prevent this whole view from scrolling */
        }
        .chat-window {
            flex-grow: 1;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 12px;
            padding-bottom: 12px;
            scroll-behavior: smooth;
        }

        .message {
            max-width: 85%;
            padding: 12px 16px;
            border-radius: 20px;
            line-height: 1.4;
            box-shadow: 0 1px 5px rgba(0, 0, 0, 0.3);
            font-size: 14px;
        }

        .ai-message {
            align-self: flex-start;
            background-color: rgba(255, 255, 255, 0.06); /* Glassmorphism background */
            color: #e6edf3;
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-bottom-left-radius: 4px;
        }
        .user-message {
            align-self: flex-end;
            background: linear-gradient(135deg, #4da9ff, #1c6db3); /* Blue Gradient for User */
            color: #ffffff;
            border-bottom-right-radius: 4px;
        }

        /* Input Area Fix for Chat View */
        #tutor-view .input-area {
            padding: 12px 0 0 0; 
            margin: 0px -20px -20px -20px; /* Align with container edges */
            background-color: #0b0e13; /* Ensure it covers the background */
            flex-shrink: 0; /* Prevents input area from being shrunk by chat window */
        }
        
        /* Loading Spinner */
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid #4da9ff !important;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
            align-self: flex-start;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* TOOL SPECIFIC STYLES */
        .tab-buttons {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
            overflow-x: auto;
            padding-bottom: 5px; /* for scrollbar visibility */
        }

        .tab-buttons .tab-button {
            flex-shrink: 0;
            padding: 8px 12px;
            margin-top: 0;
            border-radius: 8px;
            font-size: 13px;
            width: auto;
        }

        .tool-tab {
            display: none;
            padding-top: 10px;
        }
        .tool-tab.active {
            display: block;
        }

        #code-output, #test-output, #offline-joshua-response, #research-output {
            min-height: 150px;
            overflow: auto;
            padding: 15px;
            background: rgba(0, 0, 0, 0.25);
            border-radius: 10px;
            border: 1px solid rgba(255,255,255,0.02);
            margin-top: 15px;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        
        #code-output code, #test-output code {
            font-size: 13px;
        }

        textarea, input {
            width: 100%;
            padding: 12px;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.06);
            border: 1px solid rgba(255, 255, 255, 0.08);
            color: #fff;
            margin-bottom: 12px;
        }

        .error { color: #ff6b6b; }
        .success { color: #7ef1b2; }
    </style>
</head>
<body onload="switchView('home', document.getElementById('nav-home')); lucide.createIcons();">

    <!-- HEADER -->
    <header>
        <h1>JOMY KINGS MULTI-STUDY PLATFORM</h1>
    </header>

    <!-- MAIN CONTENT VIEWS (Single Page Application Structure) -->
    <main>

        <!-- 1. HOME VIEW (Default/Dashboard) -->
        <div id="home-view" class="content-view">
            <h2 class="text-2xl font-semibold mb-6 text-center text-[#4da9ff]">Your Study Dashboard</h2>

            <!-- AI Assistant Card (Links to Tutor View) -->
            <div class="card">
                <div class="flex items-center mb-3">
                    <i data-lucide="brain-circuit" class="w-6 h-6 mr-3 text-red-400"></i>
                    <h3>Joshua AI Assistant (Online)</h3>
                </div>
                <p>Your personal companion for complex calculations, concepts, and multi-subject tutoring using **real-time Gemini AI**.</p>
                <button class="open-ai-button" onclick="switchView('tutor', document.getElementById('nav-tutor'))">Open AI Tutor</button>
            </div>

            <!-- Calculators Card (Links to Tools View) -->
            <div class="card">
                <div class="flex items-center mb-3">
                    <i data-lucide="flask-conical" class="w-6 h-6 mr-3 text-yellow-400"></i>
                    <h3>Offline Tools & Sandbox</h3>
                </div>
                <p>Molar mass simulators, chemical equation logic, code execution sandboxes, and offline knowledge retrieval.</p>
                <button onclick="switchView('tools', document.getElementById('nav-tools'))">Open Tools & Sandbox</button>
            </div>

            <!-- Data/Periodic Table Card (Links to Periodic View) -->
            <div class="card">
                <div class="flex items-center mb-3">
                    <i data-lucide="grid-3x3" class="w-6 h-6 mr-3 text-blue-400"></i>
                    <h3>Periodic Table & Research Stubs</h3>
                </div>
                <p>Interactive Periodic Table and deep subject research notes. *Features are coming soon.*</p>
                <button onclick="switchView('periodic', document.getElementById('nav-periodic'))">View Research Data</button>
            </div>
        </div>

        <!-- 2. AI TUTOR VIEW (The main Chat Interface - Gemini API) -->
        <div id="tutor-view" class="content-view hidden">
            <!-- Chat Window -->
            <div id="chat-window" class="chat-window">
                <div class="ai-message message">
                    Hello! I am your Multi-Study AI Tutor, **Joshua**. I specialize in **Chemistry, Math, Physics, and more** for O-Level up to Higher Institution. I can solve calculations, explain concepts, and provide real-time information. How can I help you excel today?
                </div>
            </div>
            
            <!-- Input Area -->
            <div class="input-area flex items-center">
                <input 
                    type="text" 
                    id="user-input" 
                    placeholder="Ask your question (e.g., 'Balance H2 + O2', 'Explain momentum')..." 
                    class="flex-grow p-3"
                    onkeydown="if(event.key === 'Enter') sendMessage()"
                >
                <button 
                    id="send-button" 
                    onclick="sendMessage()" 
                    class="ml-3 p-3 rounded-full shadow-lg disabled:opacity-50 disabled:cursor-not-allowed"
                    aria-label="Send Message"
                    style="min-width: 50px; height: 50px; padding: 0; margin-top: 0;"
                >
                    <i data-lucide="send" class="w-5 h-5 mx-auto my-auto"></i>
                </button>
            </div>
        </div>

        <!-- 3. TOOLS & SANDBOX VIEW (Merged complex functionality) -->
        <div id="tools-view" class="content-view hidden">
            <h2 class="text-xl font-semibold mb-3 text-[#4da9ff]">Tools & Sandbox</h2>

            <div class="tab-buttons">
                <button id="tab-edu-btn" class="tab-button active" onclick="showToolTab('edu', this)">Education Chat</button>
                <button id="tab-code-btn" class="tab-button" onclick="showToolTab('code', this)">Code Tutor</button>
                <button id="tab-test-btn" class="tab-button" onclick="showToolTab('test', this)">Test Lab</button>
                <button id="tab-research-btn" class="tab-button" onclick="showToolTab('research', this)">Research Chat</button>
            </div>

            <!-- Education Tab (Offline Q&A) -->
            <div id="edu" class="tool-tab active">
                <p class="text-sm mb-3 text-gray-400">Ask simple, fact-based questions for instant, local responses (no internet needed).</p>
                <textarea id="offline-ai-input" placeholder="Ask Joshua offline (e.g., 'molar mass h2o')..." rows="3"></textarea>
                <div style="display:flex;gap:8px">
                    <button class="w-1/2" style="margin-top:0;" onclick="processOfflineInput(document.getElementById('offline-ai-input').value)">Get Offline Answer</button>
                </div>
                <div id="offline-joshua-response"></div>
            </div>

            <!-- Code Tab (Execution Sandbox) -->
            <div id="code" class="tool-tab">
                <p class="text-sm mb-3 text-gray-400">Write simple Python/JS code for simulation and explanation. (No actual JS execution).</p>
                <textarea id="code-input" placeholder="Write Python / JS / HTML here..." rows="8"></textarea>
                <div style="display:flex;gap:8px">
                    <button class="w-1/2" style="margin-top:0;" onclick="runAdvancedOfflineCode()">Simulate Run</button>
                    <button class="w-1/2" style="margin-top:0;" onclick="explainCode()">Explain Logic</button>
                </div>
                <pre id="code-output"><code class="language-python">Code simulation output appears here.</code></pre>
            </div>

            <!-- Test Tab (Scratchpad) -->
            <div id="test" class="tool-tab">
                <p class="text-sm mb-3 text-gray-400">A dedicated text editor for running quick scratchpad tests or drafting complex formulas.</p>
                <textarea id="test-input" placeholder="Test Lab: run experiments here..." rows="8"></textarea>
                <div style="display:flex;gap:8px">
                    <button class="w-1/2" style="margin-top:0;" onclick="runTestLabCode()">Simulate Test Run</button>
                </div>
                <pre id="test-output"><code class="language-python">Test run simulation output appears here.</code></pre>
            </div>

             <!-- Research Tab (Offline Knowledge Retrieval) -->
            <div id="research" class="tool-tab">
                <p class="text-sm mb-3 text-gray-400">Ask broad subject research questions for a simulated, locally-stored knowledge summary.</p>
                <textarea id="research-input" placeholder="Research questions (e.g., 'summarize electrochemistry')..." rows="3"></textarea>
                <div style="display:flex;gap:8px">
                    <button class="w-1/2" style="margin-top:0;" onclick="processOfflineResearch(document.getElementById('research-input').value)">Get Research Summary</button>
                </div>
                <div id="research-output">Offline research summary will appear here.</div>
            </div>
        </div>

        <!-- 4. PERIODIC VIEW (Dedicated for Future Chemistry & Research Data) -->
        <div id="periodic-view" class="content-view hidden">
            <h2 class="text-2xl font-semibold mb-6 text-center text-[#4da9ff]">Periodic Table & Data</h2>

            <div class="card">
                <div class="flex items-center mb-3">
                    <i data-lucide="grid-3x3" class="w-6 h-6 mr-3 text-green-400"></i>
                    <h3>Interactive Periodic Table</h3>
                </div>
                <p>
                    Access detailed information on all elements. View electronic configurations, isotopes, and properties. *Coming Soon: Next Feature Update*
                </p>
                <button>View Table</button>
            </div>

            <div class="card">
                <div class="flex items-center mb-3">
                    <i data-lucide="book-open" class="w-6 h-6 mr-3 text-red-400"></i>
                    <h3>Advanced Research & Study Notes</h3>
                </div>
                <p>
                    Curated summaries and tutorials on advanced science topics (Chemistry, Physics, Biology). *Coming Soon: Next Feature Update*
                </p>
                <button>Open Study Hub</button>
            </div>
        </div>
        
        <!-- 5. SETTINGS VIEW -->
        <div id="settings-view" class="content-view hidden">
            <h2 class="text-2xl font-semibold mb-6 text-center text-[#4da9ff]">Settings & Support</h2>
            
            <!-- General Settings Stub -->
            <div class="card">
                <h3>App Preferences</h3>
                <div class="flex justify-between items-center py-3 border-b border-gray-700">
                    <span class="text-white">Theme Switching</span>
                    <button onclick="toggleTheme()" id="theme-button" class="px-3 py-1 bg-gray-700 rounded text-white text-sm w-auto">Toggle Dark/Light</button>
                </div>
                <div class="flex justify-between items-center py-3">
                    <span class="text-white">Default AI Subject</span>
                    <select class="p-1 bg-gray-700 rounded text-white text-sm w-auto" style="background: rgba(255, 255, 255, 0.06); border: 1px solid rgba(255, 255, 255, 0.08);">
                        <option>Chemistry (Default)</option>
                        <option>Mathematics</option>
                        <option>Physics</option>
                        <option>Biology</option>
                    </select>
                </div>
            </div>

            <!-- Support Card -->
            <div class="card">
                <h3>Support & Community</h3>
                <button class="w-full p-3 mb-3 bg-gray-700 rounded-lg text-gray-300 hover:bg-gray-600 transition flex items-center justify-center"><i data-lucide="message-square" class="w-5 h-5 mr-2"></i> Send Feedback</button>
            </div>
        </div>

    </main>
    
    <!-- NAVIGATION BAR (Fixed Bottom) -->
    <div class="nav-bar">
        <button id="nav-home" onclick="switchView('home', this)" class="active">
            <i data-lucide="layout-dashboard"></i>
            <span>Home</span>
        </button>
        <button id="nav-tutor" onclick="switchView('tutor', this)">
            <i data-lucide="brain-circuit"></i>
            <span>Joshua AI</span>
        </button>
        <
